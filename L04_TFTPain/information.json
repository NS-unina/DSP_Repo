{"description":"A simple lab about scanning and enumeration of FTP/TFTP.","goal":"<p>The goal is to find the alive and vulnerable machines among the IPs obtained at the end of the footprinting phase and to exfiltrate some sensitive information.</p>","solution":"<p>First of all we have to download the following images through the \"docker pull\" command:<br /><br /><em>emalderson/ftplab:ftp_1.0</em><br /><em>emalderson/ftplab:tftp_1.0</em><br /><em>emalderson/ftplab:attacker_1.0</em><br /><br />Now we can start the lab and create an hacktool using the \"emalderson/ftplab:attacker_1.0\" image, then attach it to the network.<br /><br />Let's suppose that the output of the footprinting phase gave us the following block of IPs: <br /><em>193.20.1.0/24</em><br /><br />Now we can proceed with the scanning phase.<br />The first thing to do is the so called ping sweep, which has the objective of finding the alive machines (the ones responding to an echo request), narrowing the field of the possible targets.<br />We can note that the \"ping sweep\" can be done using tcp/udp packets as well. This can be useful in a scenario in which the icmp traffic is blocked, but this is not the case.<br />To do this, we can use the program nmap in this way:<br /><br /><em>nmap -n -sn --send-ip -PE 193.20.1.1-255</em><br /><br />With this command we are telling the program to avoid resolving the IPs through the DNS service (-n), send only IP packets (--send-ip) and, in particular, send only ICMP Echo Request (-PE).<br />The output of the command is reported below:<br /><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/1.png\" alt=\"\" width=\"615\" height=\"397\" /><br />From that output we can see that there are 4 hosts up, where the \".1\" is the default gateway and one of them is the attacker machine. To find out which is the attacker machine, we can launch an \"ifconfig\" command. It shows that the attacker machine has the IP \".4\".</p>\n<p><br />At this point we can start with the \"port scanning\" phase on a reduced number of hosts (only 2 hosts) using nmap with the following command:</p>\n<p><br /><em>nmap -n -sT -Pn 193.20.1.2-3</em></p>\n<p><br />With this command we are telling the program to perform a TCP connect scan (-sT) on 1000 ports of possible interest (by default) treating all hosts as alive (-Pn) which means skipping the ping sweep because we have already performed it, avoiding again the DNS resolution (-n).<br />The output of the command is reported below:<br /><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/2.png\" alt=\"\" width=\"601\" height=\"362\" /></p>\n<p><br />We can do the same thing using the -sU flag, which performs an UDP scan:</p>\n<p><br /><em>nmap -n -sU -Pn -F 193.20.1.2-3</em></p>\n<p>It has been used also the -F flag to reduce the number of tested ports from 1000 to 100 in order to speed up the scan.<br />The output of the command is reported below:<br /><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/3.png\" alt=\"\" width=\"666\" height=\"350\" /></p>\n<p><br />We have discovered that there are 2 ports open, in particular there is a port 21/tcp open on the \".2\" host, which is commonly used for FTP, and a port 69/udp open on the \".3\" host, which is commonly used for TFTP.</p>\n<p>Now we can go ahead and start the enumeration phase. In this phase we will try to detect what is the actual service behind the ports we have just found and their versions. This is useful because if we found a vulnerable version of a service we could exploit it, but we could also find some service which is misconfigured and that permits us to grab some useful information.</p>\n<p>We can start with the service fingerprinting through nmap with the following command:</p>\n<p><br /><em>nmap -n -sV -p 21 193.20.1.2</em></p>\n<p>&nbsp;</p>\n<p>The purpose of the option -sV is to perform a version scan on the port 21 (-p).</p>\n<p>The output of the command is reported below:</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/4.png\" alt=\"\" width=\"885\" height=\"282\" /></p>\n<p>&nbsp;</p>\n<p>We know that with TFTP we have to know the exact name of a resource to get it, so this appears not to be our target.</p>\n<p>So let's try with the FTP service. We know that we may need an username and a password, maybe this username could have been obtained during the footprinting phase, but this is not the case.</p>\n<p>So what could we do? Remember that FTP has a feature called \"anonymous login\" which, if enabled, permits anyone to login. Let's find out if this feature is enabled by typing \"ftp\" to start the ftp client.</p>\n<p>Now we have to type \"open\" and then, when requested, type the IP of the target, which is 192.20.1.2.</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/5_1.png\" alt=\"\" width=\"314\" height=\"111\" /></p>\n<p>Now we are prompted for a username, so we can type in \"anonymous\" and insert no password.</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/5_2.png\" alt=\"\" width=\"356\" height=\"128\" /></p>\n<p>In this case we are allowed to enter!</p>\n<p>Now we can type in \"ls\" to list the content inside the folder</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/5_3.png\" alt=\"\" width=\"705\" height=\"109\" /></p>\n<p>We found something! Let's try to get it using the \"get\" command!</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/5_4.png\" alt=\"\" width=\"543\" height=\"74\" /></p>\n<p>Oh no, we can't... but don't forget to write down the name of this file, it could be an useful information anyway. Infact we could try to use this name on the TFTP server!</p>\n<p>To do this we have to quit the FTP session (with the \"quit\" command) and start the TFTP client typing \"tftp\" followed by the IP of the target, which is 193.20.1.3.</p>\n<p>Now let's try to get the same file we found in the other host.</p>\n<p><img src=\"https://raw.githubusercontent.com/emalderson/DSP_Repo/master/TFTPain/.images/5_5.png\" alt=\"\" width=\"711\" height=\"491\" /></p>\n<p>GOT IT! Someone probably downloaded the file from the TFTP server to the FTP server but even though he protected the file on the second one, he forgot to disable the TFTP access on the first one that has been left unprotected!</p>\n<p>This file contains a lot of usernames and passwords belonging to the employees of the target organization (credits to giper45 and his \"Topolinux\" lab for the information copy-pasted in this file).</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>","readme":"","difficulty":"Medium","author":"NS"}
