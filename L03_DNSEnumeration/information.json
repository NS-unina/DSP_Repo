{"description":"Practice your DNS Enumeration skills.","goal":"<p>Use the \"dns-utils\" Hack Tool to attempt a zone transfer from dspdnsenum.lab</p>","solution":"<h2>DNS Enumeration</h2>\n<p>DNS servers often host juicy information about public and sometimes private organization networks, such as IP addresses, server names and functionalities. Thus, DNS represents a rather interesting source for information gathering.</p>\n<p>For this Lab, a domain named \"dspdnsenum.lab\" was created, in order to let you play with DNS messages and responses.</p>\n<p>The ultimate purpose of this lab is to attempt a transfer zone from the domain servers.</p>\n<p>To let you interact with DNS servers in this Lab, a useful Hack Tool was designed. It's called \"dns-utils\" and contains several tools that will let you perform DNS lookups.</p>\n<p>Let's go on and start the lab and run the dns-utils container.</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/dnsutils_hacktool.png\" alt=\"\" width=\"1824\" height=\"611\" /></p>\n<p>Remember to attach it to the public network.</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/running_hacktool.png\" alt=\"\" width=\"1832\" height=\"199\" /></p>\n<h3>HOST</h3>\n<p>The first utility that we are going to take a look at is \"Host\", a simple and famous tool for performing DNS lookups. Even with this simple tool, we will be able to complete the laboratory.</p>\n<p>Usually a DNS server divulges two fundamental information publicly: the \"name\" and \"mail\" servers for the domain it has authority over. Let's try and look for these entries on the domain dspdnsenum.lab.</p>\n<p style=\"padding-left: 30px;\">$ host -t ns dspdnsenum.lab 193.21.1.2</p>\n<p>The \"-t\" option lets us specify the type of record we are looking for in the lookup. It is important that we specify the IP address of the DNS server (193.21.1.2) at the end, because \"dspdnsenum.lab\" is obviously an ad-hoc domain created only for the scope of this Lab, therefore its records are not publicly available.</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_ns.png\" alt=\"\" width=\"465\" height=\"182\" /></p>\n<p>As a response we get the list of name servers the domain has authority over.</p>\n<p>Next, we can look for mail servers.</p>\n<p style=\"padding-left: 30px;\">$ host -t mx dspdnsenum.lab 193.21.1.2</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_mx.png\" alt=\"\" width=\"541\" height=\"170\" /></p>\n<p>The response contains the list of e-mail server host names.</p>\n<p>&nbsp;</p>\n<p>It's always worth to try performing a transfer zone, even though in most modern configurations (fortunately!) they are disabled for most users.</p>\n<p style=\"padding-left: 30px;\">$ host -l dspdnsenum.lab 193.21.1.2</p>\n<p>The \"-l\" is the option that allows to request for a transfer zone.</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_transfer_failed.png\" alt=\"\" width=\"416\" height=\"146\" /></p>\n<p>As expected, transfer zone are disabled for most users.</p>\n<p>Fortunately, even though zone transfer are forbidden, we have other options.</p>\n<p>For example we can try asking for a SOA record, which contains administrative information about the zone. In some cases even something about zone transfers.</p>\n<p style=\"padding-left: 30px;\">$ host -t soa dspdnsenum.lab 193.21.1.2</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/soa_host.png\" alt=\"\" width=\"966\" height=\"128\" /></p>\n<p>A SOA record has a specific syntax. You can take a look at RFC 1034, section 3.13.3, for details.</p>\n<p>Basically, we are interested in the first two strings that the response returns, that are:</p>\n<ul>\n<li>the primary master name server for the dspdnsenum.lab zone (ns1.dspdnsenum.lab);</li>\n<li>the email address of the administrator responsible for this zone. In BIND syntax the reponse carries the name server responsible for that email address (admin.dspdnsenum.lab).</li>\n</ul>\n<p>&nbsp;</p>\n<p>We can push the analysis forward, by taking a look at address records (A records).</p>\n<p>For example, lookup for the IP address of the recently discovered name server \"admin.dspdnsenum.lab\".</p>\n<p style=\"padding-left: 30px;\">$ host -t a admin.dspdnsenum.lab 193.21.1.2</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_a_admin.png\" alt=\"\" width=\"475\" height=\"125\" /></p>\n<p>We just discovered the IP address of the admin server.</p>\n<p>We can carry on this process to discover more host names and IP addresses belonging to dspdnsenum.lab. For example, we can assume that dspdnsenum.lab domain has a webserver, with the hostname \"www\".</p>\n<p style=\"padding-left: 30px;\">$ host -t a www.dspdnsenum.lab 193.21.1.2</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/www_host.png\" alt=\"\" width=\"449\" height=\"127\" /></p>\n<p>Now let's check if the domain has a server with the hostname \"ftp\", for example.</p>\n<p style=\"padding-left: 30px;\">$ host -t a ftp.dspdnsenum.lab 193.21.1.2</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_ftp.png\" alt=\"\" width=\"469\" height=\"125\" /></p>\n<p>It doesn't.</p>\n<p>&nbsp;</p>\n<p>We can continue on this path, by placing before the domain name \"dspdnsenum.lab\", a list of common hostnames that usually a domain holds. This is the solution that any famous script applies to brute-force a domain and get as many information as possible about its hostnames.</p>\n<p>Let's do this by creating a \"list.txt\" file and than use it to perform lookups. A good thing would be to insert the hostnames that have been already discovered in previous lookups, such as mail servers and authoritative servers.</p>\n<p style=\"padding-left: 30px;\">$ echo www &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo mail &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo mail2 &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo router &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo proxy &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo admin &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo ns1 &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo ns2 &gt;&gt; list.txt</p>\n<p style=\"padding-left: 30px;\">$ echo ns3 &gt;&gt; list.txt</p>\n<p>Later, we can write an inline script that loops over entries in this text file and for everyone of them performs a lookup for A records:</p>\n<p style=\"padding-left: 30px;\">$ for i in $(cat list.txt); do host $i.dspdnsenum.lab 193.21.1.2; done</p>\n<p>&nbsp;<img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/host_inline_script.png\" alt=\"\" width=\"871\" height=\"954\" /></p>\n<p>What can we deduce from the output of this command?</p>\n<p>By analysing the IP addresses returned from this lookups we notice that most of the hosts discovered have private IP addresses, while the master server \"ns1.dspdnsenum.lab\" has an IP address that belongs to the same subnet of the primary server.&nbsp; We can try performing a zone transfer on this new server.</p>\n<p style=\"padding-left: 30px;\">$ host -l dspdnsenum.lab 193.21.1.3</p>\n<p><img src=\"https://raw.githubusercontent.com/NS-unina/DSP_Repo/master/L03_DNSEnumeration/.images/transfer_zone.png\" alt=\"\" width=\"440\" height=\"450\" />&nbsp;</p>\n<p>Owned!</p>\n<p>The primary server does not allow for zone transfers, but the master server does!</p>\n<h3>DIG</h3>\n<p>The dns-utils hack tool is engaged with several other DNS utilities that we can use to reproduce the previous steps.</p>\n<h4>NS Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ dig ns @193.21.1.2 dspdnsenum.lab +noall +answer</p>\n<h4>MX Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ dig mx @193.21.1.2 dspdnsenum.lab +noall +answer</p>\n<h4>A Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ dig a @193.21.1.2 dspdnsenum.lab +noall +answer</p>\n<p style=\"padding-left: 30px;\">$ dig a @193.21.1.2 dspdnsenum.lab +short</p>\n<h4>Zone Transfer</h4>\n<p style=\"padding-left: 30px;\">$ dig axfr @193.21.1.3 dspdnsenum.lab</p>\n<p style=\"padding-left: 30px;\">&nbsp;</p>\n<h3>NSLOOKUP</h3>\n<h4>NS Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ nslookup -type=ns dspdnsenum.lab 193.21.1.2</p>\n<h4>MX Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ nslookup -type=mx dspdnsenum.lab 193.21.1.2</p>\n<h4>A Record Lookup</h4>\n<p style=\"padding-left: 30px;\">$ nslookup -type=a dspdnsenum.lab 193.21.1.2</p>\n<h4>Zone Transfer</h4>\n<p style=\"padding-left: 30px;\">$ nslookup \\ server 193.21.1.2 \\ set type=any \\ ls -d dspdnsenum.lab &gt;&gt; zone_out</p>\n<p>If the \"ls\" command is disabled on the server you can explicitly ask for AXFR records.</p>\n<p style=\"padding-left: 30px;\">$ nslookup -type=axfr dspdnsenum.lab 193.21.1.2</p>\n<p style=\"padding-left: 30px;\">$ nslookup -type=axfr dspdnsenum.lab 193.21.1.3</p>\n<p>&nbsp;</p>\n<h3>DNSRECON</h3>\n<p style=\"padding-left: 30px;\">$ dnsrecon.py -n 193.21.1.2 -d dspdnsenum.lab -t std</p>\n<p style=\"padding-left: 30px;\">$ dnsrecon.py -n 193.21.1.2 -d dspdnsenum.lab -t brt -D namelist.txt</p>\n<h3>FIERCE</h3>\n<p style=\"padding-left: 30px;\">$ perl fierce.pl -dns dspdnsenum.lab -dnsserver 193.21.1.2</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>","readme":"","difficulty":"Beginner","author":"NS"}
