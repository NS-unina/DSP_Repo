







<?php









?>







<link rel="stylesheet" href="<?php echo plugins_url() ?>/mail-masta/lib/css/mail-masta.css" />







<?php















global $wpdb;







$masta_campaign=$wpdb->prefix . "masta_campaign";







$camp_id=220;







 $masta_report = $wpdb->prefix . "masta_reports";







 







 $campaigndata = $wpdb->get_results( "SELECT * FROM $masta_campaign WHERE camp_id = $camp_id");







 if(count($campaigndata) > 0) {







	$campdata = $campaigndata[0];







    $list_id = $campdata->to_list;







    $camp_status = $campdata->status;







?>







<div class="view_campaigns">







    <div class="panel panel-default">







        <div class="panel-heading"><div class="mm_title_name"><?php echo $campdata->campaign_name; ?></div></div>







            <div class="panel-body">







                <div class="container">







    







<?php    







if($camp_status == 2 ){







	//this code run if campaign status is 2 = paused.







    $sub_data = $wpdb->get_results("SELECT count(id) as ttl_sub,(select count(id) from $masta_report where status = 1 and camp_id= $camp_id) as ttl_sent FROM $masta_report WHERE camp_id = $camp_id  and list_id = $list_id ");







    if(count($sub_data)){







		







	   $sub_count = $sub_data[0]->ttl_sub;







	   $ttl_sent = $sub_data[0]->ttl_sent; 	







	   $avg_sent = ($ttl_sent / $sub_count ) * 100; 







	} else {







	   $sub_cout = '0';	







	   $ttl_sent = '0';







	   $avg_sent = '0';







	}







	







?>







 <div class="confirm_msg">







 <div class="row">







 <div class="col-sm-12">







<input type="hidden" name="campid" id="campid" value="<?php if(!empty($camp_id)){ echo $camp_id;}else{ echo '';}?>">







<input type="hidden" name="listid" id="listid" value="<?php if(!empty($list_id)){ echo $list_id;}else { echo '';}?>">







<input type="hidden" name="subcount" id="subcount" value="<?php if(!empty($sub_count)){ echo $sub_count;} else { echo '0';}?>">







<input type="hidden" name="ttl_sent" id="ttl_sent" value="<?php echo $ttl_sent;?>">







<input type="hidden" name="is_send" id="is_send" value="">















<div class="progress">







	  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: <?php echo $avg_sent?>%" id="send_progress">







		<span class="sr-only">40% Complete (success)</span>







	  </div>







 </div>







 <div class="clearfix">







		<div class="mm_float_left"><span id="ttlsent"><?php echo $ttl_sent;?></span> / <span id="ttlsub"><?php if(!empty($sub_count)){ echo $sub_count;}else{ echo '0';}?></span> sent</div>







		<div class="mm_float_right">







        <div id="show_progress_avg">







        	<?php 







				$avg = ($ttl_sent / $sub_count)* 100;







				if(!empty($avg)){







				  echo $avg.' % Complete';	







				} 







			?>







        </div>







		    <a title="Resume Campaign" class="btn btn-default" href="#" id="start" onclick="camp_action(this.id)"><i class="fa fa-play"></i></a>







		</div>







 </div>







 







 <div id="msg_div" style="color:green;font-size:20px;display:none">







     All recepeints got the email..if you are one of them please check your email. 







 </div>























</div>







</div>















<?php







} else {







	//this is campaing detail and report view section







	$ttl_users = '0';







	$ttl_subscriber = '0';







	$ttl_unsubscriber = '0';







	$ttl_opened = '0';







	$ttl_bounce = '0';







	$ttl_mail_sent = '0';







	$ttl_not_opened = 0;







	







	//query variables for campaign report.







	$common_condition = "camp_id = $camp_id  and list_id = $list_id";







	//echo $common_condition;







	$sub_sql = "(select count(id) from $masta_report where sub_status = '1' and $common_condition) as ttl_subscriber ";







	$unsub_sql = "(select count(id) from $masta_report where sub_status = '2' and $common_condition) as ttl_unsubscriber";







	$open_sql = "(select count(id) from $masta_report where opened = '1' and $common_condition) as ttl_opened";







	$clicked= "(select count(id) from $masta_report where clicked = '1' and $common_condition) as ttl_clicked";







	$bounce_sql = "(select count(id) from $masta_report where bounce = '1' and $common_condition) as ttl_bounce";







	$mail_sent_sql = "(select count(id) from $masta_report where status = '1' and sub_status = '1' and $common_condition) as ttl_mail_sent";







	$ttl_sql = "SELECT count(id) as ttl_sub,$sub_sql,$clicked,$unsub_sql,$open_sql,$bounce_sql,$mail_sent_sql FROM $masta_report WHERE $common_condition";







	//echo $ttl_sql;







    $report_data = $wpdb->get_results($ttl_sql);







  //  print_r($report_data);







    //print_r($report_data);







	if(count($report_data) > 0){







		







		







		$ttl_users = $report_data[0]->ttl_sub;







		$ttl_subscriber = $report_data[0]->ttl_subscriber;







		$ttl_unsubscriber = $report_data[0]->ttl_unsubscriber;







		$ttl_opened = $report_data[0]->ttl_opened;







		$ttl_bounce = $report_data[0]->ttl_bounce;







		$ttl_mail_sent = $report_data[0]->ttl_mail_sent;







		$ttl_not_opened = ($ttl_mail_sent)-($ttl_opened);







		$ttl_clicked_link=$report_data[0]->ttl_clicked;







		$opened_rate=round(($ttl_opened/$ttl_mail_sent)*100,2);







		$clicked_rate=round(($ttl_clicked_link/$ttl_mail_sent)*100,2);







		$subscribed_rate=round(($ttl_subscriber/$ttl_users)*100,2);







		







	







	} 







	







	$country_sql = "SELECT `country_code`, COUNT(id) TotalCount FROM $masta_report where  opened = '1' and country_code!='' GROUP BY `country_code`   ORDER BY COUNT(id) DESC";







	$country_data = $wpdb->get_results($country_sql);







  







 ?>	















<!--Opened rate-->







		







		<?php if($opened_rate!=0){ ?>







				<canvas id="canvas1" height="200" width="200"></canvas>







		<?php } else { ?>







				<span class="nodata">No Data</span>







		<?php } ?>







		







 		<span style="color:#F38630"><?php echo $opened_rate;  ?>% opened rate</span>







 <!--end of opened rate-->







 







 







 <!-- click rate -->







 		<?php if($clicked_rate!=0){ ?>







				<canvas id="canvas2" height="200" width="200"></canvas>







		<?php } else { ?>







				<span class="nodata">No Data</span>







		<?php } ?>







 		<span style="color:#F38630"><?php echo $clicked_rate  ?>% clicked rate</span>







  <!-- end of click rate -->







 







 







 <!-- subscribe rate -->







 		 <?php if($subscribed_rate!=0){ ?>







				<canvas id="canvas3" height="200" width="200"></canvas>







		<?php } else { ?>







				<span class="nodata">No Data</span>







		<?php } ?>







 		<span style="color:#F38630"><?php echo $subscribed_rate  ?>% subscribe rate</span>







  <!-- end of subscribe rate --><br>







  







  







  <!--map rate-->







  







  







   <script type='text/javascript' src='https://www.google.com/jsapi'></script>







    <script type='text/javascript'>







     google.load('visualization', '1', {'packages': ['geochart']});







     google.setOnLoadCallback(drawRegionsMap);















      function drawRegionsMap() {







        var data = google.visualization.arrayToDataTable([







         ['Country', 'opened'],







       // ['Germany', 200],







         // ['United States of America', 300],







        // ['Brazil', 400],







        // ['Canada', 500],







       // ['France', 600],







        // ['IN', 700]







      <?php







      







        foreach($country_data as $country_sqls){







				echo "['".$country_sqls->country_code."', ".$country_sqls->TotalCount."],\n";







			 }







	?>







         







        ]);















        var options = {};















        var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));







        chart.draw(data, options);







    };







    </script>







     <div id="chart_div" style="width: 900px; height: 500px;"></div>







     







     <!--end map rate -->







     







    <!--last 10 opened  email list -->







	







	<?php 







	







	







	$top10list=$wpdb->get_results("SELECT subscriber_email FROM $masta_report WHERE camp_id =$camp_id LIMIT 0 , 9");







	







	







	 ?>







	







	<!--end of top 10 opened list -->







 







 







<?php } ?>







 















 <script src="<?php echo plugins_url( 'mail-masta/lib/Chart.js' )  ?>"></script>







 	







<!--Opened rate(js)-->















	<script>















		var pieData = [







				{







					value: parseInt("<?php echo $ttl_opened; ?>"),







					color:"#F38630"







				},







				{







					value : parseInt("<?php echo $ttl_not_opened; ?>"),







					color : "#E0E4CC"







				}







			







			];















	var myPie = new Chart(document.getElementById("canvas1").getContext("2d")).Pie(pieData);







	</script>







 <!--end of opened rate(js)-->







 







 







<!-- click rate(js) -->







 	<script>















		var pieData = [







				{







					value: parseInt("<?php echo $ttl_clicked_link; ?>"),







					color:"#F38630"







				},







				{







					value : parseInt("<?php echo $ttl_mail_sent-$ttl_clicked_link; ?>"),







					color : "#E0E4CC"







				}







			







			];















	var myPie = new Chart(document.getElementById("canvas2").getContext("2d")).Pie(pieData);







	</script>







   <!-- end of click rate(js) -->







 







  <!-- subscribe rate(js) -->







  	<script>















		var pieData = [







				{







					value: parseInt("<?php echo $ttl_subscriber; ?>"),







					color:"#F38630"







				},







				{







					value : parseInt("<?php echo $ttl_unsubscriber; ?>"),







					color : "#E0E4CC"







				}







			







			];















	var myPie = new Chart(document.getElementById("canvas3").getContext("2d")).Pie(pieData);







	</script>







   <!-- end of subscribe rate(js) --> 		































<?php } else {







			   header("location:".admin_url()."/admin.php?page=masta-campaign");	







} ?>







